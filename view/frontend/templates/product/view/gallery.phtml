<div class="gallery media-gallery">
    <ul id="lightSlider">
        <?php
    $galleryImages = $block->getGalleryImages();

    foreach ($galleryImages as $galleryImage) {
        $imageUrl = $galleryImage->getMediumImageUrl();
        $smallImageUrl = $galleryImage->getSmallImageUrl();

        if ($galleryImage->getMediaType() === 'external-video') {
            $largeImageUrl = $galleryImage->getVideoUrl();
        } else {
            $largeImageUrl = $galleryImage->getLargeImageUrl();
        } ?>
        <li data-thumb="<?php echo $smallImageUrl; ?>"
            data-sub-html="<?php echo $galleryImage->getLabel(); ?>"
            data-src="<?php echo $largeImageUrl; ?>">
            <img <?php
                // data-src
                // as https://stackoverflow.com/questions/57674943/how-do-i-lazy-load-images-in-jquery-lightslider
                ?>
            data-src="<?php echo $imageUrl; ?>"
            src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNgYAAAAAMAASsJTYQAAAAASUVORK5CYII="
            alt="<?php echo $galleryImage->getLabel(); ?>"
            width="370" <?php // taken from config!?>
            />
        </li>
        <?php
    }
    ?>
    </ul>
</div>
<script>
    require(
        [
            'jquery',
            'lightSlider',
            'lightGallery',
            'domReady!'
        ],
        function($, a, b) {
            require([
                    'lightGalleryVideo',
                    'lightGalleryZoom'
                ],
                function() {
                    $('#lightSlider').lightSlider({
                        gallery: true,
                        item: 1,
                        loop: true,
                        slideMargin: 0,
                        thumbItem: 6,
                        zoom: true,
                        actualSize: true,
                        youtubePlayerParams: {
                            modestbranding: 1,
                            showinfo: 0,
                            controls: 0
                        },
                        onSliderLoad: function(el) {
                            el.lightGallery({
                                download: false
                            });

                            var showActiveSlides = function(entries) {
                                entries.forEach(function(entry) {
                                    if (entry.isIntersecting) {
                                        entry.target.src = entry.target.dataset.src;
                                        observer.unobserve(entry.target);
                                    }
                                });
                            };

                            var imageWidth = el.find("li").outerWidth() + "px";

                            var observer = new window.IntersectionObserver(showActiveSlides, {
                                root: el.parent()[0],
                                rootMargin: "0px " + imageWidth + " 0px " + imageWidth
                            });

                            el.find("li img").each(function() {
                                observer.observe(this);
                            });
                        }
                    });
                }
            );
        });
</script>